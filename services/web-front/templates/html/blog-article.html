{{ template "header.html" .}}
<!-- Syntax Highlighting Styles -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

<style>
    /* Light sky blue background for code blocks */
    pre {
        background-color: #e6f3ff !important;
    }

    /* Responsive images in article content */
    .article-content img {
        max-width: 100%;
        height: auto;
    }
</style>

<script>
    // Initialize syntax highlighting
    document.addEventListener('DOMContentLoaded', function () {
        // Highlight code blocks
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });

        // Render math expressions with KaTeX
        document.querySelectorAll('.math').forEach((element) => {
            try {
                katex.render(element.textContent, element, {
                    throwOnError: false,
                    displayMode: element.classList.contains('math-display')
                });
            } catch (e) {
                console.warn('KaTeX rendering failed:', e);
            }
        });
    });
</script>
<!-- Page Content-->
<section class="py-5">
    <div class="container px-5 my-5">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <div class="article-wrapper">
                    <article>
                        <div class="mb-3">
                            <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">‚Üê Back</a>
                        </div>
                        <header class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="text-muted small">By {{ .post.Author.Username }}</div>
                                {{ if and .isLoggedIn (eq .userId .post.Author.ID) }}
                                <div>
                                    <a class="btn btn-orange btn-sm me-2" href="/blog-edit/{{ .post.ID }}" role="button"
                                        value="Edit">Edit</a>
                                    <a class="btn btn-orange btn-sm" href="/blog-remove/{{ .post.ID }}" role="button"
                                        value="Remove">Remove</a>
                                </div>
                                {{ end }}
                            </div>
                            <h1 class="fw-bolder mb-1">
                                <span id="title-ko" style="display:none">{{.post.Title}}</span>
                                <span id="title-en">{{if
                                    .post.EnTitle}}{{.post.EnTitle}}{{else}}{{.post.Title}}{{end}}</span>
                            </h1>
                            <div class="text-muted fst-italic mb-2">{{ .post.UpdatedAt.Format "January 2, 2006" }}</div>
                            {{ if .post.Tags }}
                            <div class="mb-3">
                                {{ range $i, $t := .post.Tags }}
                                <a href="/blog?tag={{ $t.Name }}"
                                    class="badge bg-secondary text-decoration-none me-1">{{ $t.Name }}</a>
                                {{ end }}
                            </div>
                            {{ end }}
                            {{ if .post.Thumbnail }}
                            <img src="{{ .post.Thumbnail }}" alt="Thumbnail" class="img-fluid mb-3"
                                style="max-width: 100%; height: auto;">
                            {{ end }}

                        </header>
                        <!-- Language toggle -->
                        <div class="mb-3">
                            <div class="btn-group" role="group" aria-label="Language toggle">
                                <button id="lang-en" class="btn btn-outline-secondary btn-sm active">English</button>
                                <button id="lang-ko" class="btn btn-outline-secondary btn-sm">Korean</button>
                            </div>
                        </div>

                        <!-- HTML content for both languages -->
                        <div id="content-en" class="article-content">
                            {{ .post.EnContent }}
                        </div>
                        <div id="content-ko" class="article-content" style="display: none;">
                            {{ .post.Content }}
                        </div>
                        <div id="translation-notice" class="mt-3 text-muted small" style="display: none;">
                            Translated by DeepL
                        </div>
                    </article>
                </div>
            </div>
            <!-- Navigation Sidebar (Right) -->
            <nav class="col-lg-3 d-none d-lg-block ps-4">
                <div id="article-toc" class="position-sticky" style="top: 100px;"></div>
            </nav>
        </div>
    </div>
</section>
<script src="/templates/js/scripts.js"></script>
<script>
    // Language toggle functionality
    document.addEventListener('DOMContentLoaded', function () {
        const btnKo = document.getElementById('lang-ko');
        const btnEn = document.getElementById('lang-en');
        const titleKo = document.getElementById('title-ko');
        const titleEn = document.getElementById('title-en');
        const contentKo = document.getElementById('content-ko');
        const contentEn = document.getElementById('content-en');
        const translationNotice = document.getElementById('translation-notice');

        // Default to English
        if (translationNotice) translationNotice.style.display = 'block';

        btnKo.addEventListener('click', function () {
            btnKo.classList.add('active');
            btnEn.classList.remove('active');
            if (titleKo) titleKo.style.display = '';
            if (titleEn) titleEn.style.display = 'none';
            if (contentKo) contentKo.style.display = '';
            if (contentEn) contentEn.style.display = 'none';
            if (translationNotice) translationNotice.style.display = 'none';
            // Re-highlight code blocks after content change
            setTimeout(() => {
                document.querySelectorAll('#content-ko pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }, 10);
        });

        btnEn.addEventListener('click', function () {
            btnEn.classList.add('active');
            btnKo.classList.remove('active');
            if (titleKo) titleKo.style.display = 'none';
            if (titleEn) titleEn.style.display = '';
            if (contentKo) contentKo.style.display = 'none';
            if (contentEn) contentEn.style.display = '';
            if (translationNotice) translationNotice.style.display = 'block';
            // Re-highlight code blocks after content change
            setTimeout(() => {
                document.querySelectorAll('#content-en pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }, 10);
        });
    });
</script>
</main>

{{ template "footer.html" .}}