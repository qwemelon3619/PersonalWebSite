{{ template "header.html" . }}
<style>
    .custom-pagination .page-link {
        color: var(--text-dark);
        background: #fff;
        border: 1.5px solid var(--border-color);
        transition: 0.15s;
    }

    .custom-pagination .page-link:hover {
        background: var(--primary-orange);
        color: #fff;
        border-color: var(--primary-orange);
    }

    .custom-pagination .active .page-link {
        background: var(--primary-orange);
        color: #fff;
        border-color: var(--primary-orange);
        font-weight: 800;
        box-shadow: 0 2px 8px rgba(255, 159, 103, 0.08);
    }

    .custom-pagination .page-item.disabled .page-link {
        color: #bbb;
        background: #f4f4f2;
        border-color: var(--border-color);
    }

    .custom-pagination {
        gap: 0.25rem;
    }
</style>
<section class="py-5 bg-opacity-50">
    <div class="container py-5">
        <h2 class="section-title mb-5">Blog Articles</h2>
        <div class="row">
            <div class="col-lg-8">
                <div class="row g-4">
                    {{ if .posts }}
                    {{ range $key, $value := .posts }}
                    <div class="col-md-6">
                        <div class="card-custom h-100 border-0 shadow-sm">
                            <a href="/blog/{{$value.ID}}" class="d-block position-relative">
                                <img class="w-100 object-fit-cover"
                                    style="height:220px;object-fit:cover;border-top-left-radius:16px;border-top-right-radius:16px;"
                                    src="/assets/blog_img/sample.jpg" alt="{{$value.Title}}" loading="lazy" />
                            </a>
                            <div class="p-4">
                                <div class="mono-text small mb-2">{{$value.UpdatedAt.Format "Jan 02, 2006"}}</div>
                                <a class="text-decoration-none text-dark" href="/blog/{{$value.ID}}">
                                    <h5 class="fw-bold mb-2 text-truncate">{{$value.Title}}</h5>
                                </a>
                                {{ if $value.Tags }}
                                <div class="mb-2">
                                    {{ range $i, $t := $value.Tags }}
                                    <a href="/blog?tag={{ $t.Name }}" class="badge bg-light text-dark me-1">{{ $t.Name
                                        }}</a>
                                    {{ end }}
                                </div>
                                {{ end }}
                                <a class="btn btn-orange px-4" href="/blog/{{$value.ID}}">Read more</a>
                            </div>
                        </div>
                    </div>
                    {{ end }}
                    {{ else }}
                    <div class="col-12 text-center py-5 border border-secondary border-dashed rounded">
                        <p class="text-muted">No articles found.</p>
                    </div>
                    {{ end }}
                </div>

                <!-- Pagination-->
                <nav aria-label="Pagination">
                    <hr class="my-0" />
                    <ul class="pagination justify-content-center my-4 custom-pagination">
                        <li class="page-item {{if eq .page 1}}disabled{{end}}">
                            <a class="page-link rounded-pill px-3"
                                href="?page={{.prevPage}}{{if .search}}&search={{.search}}{{end}}{{if .tag}}&tag={{.tag}}{{end}}"
                                tabindex="-1" aria-disabled="{{if eq .page 1}}true{{end}}">&laquo;</a>
                        </li>
                        {{ range $i := .pageNumbers }}
                        <li class="page-item {{if eq $.page $i}}active{{end}}">
                            <a class="page-link rounded-pill mx-1 px-3 fw-bold"
                                href="?page={{$i}}{{if $.search}}&search={{$.search}}{{end}}{{if $.tag}}&tag={{$.tag}}{{end}}">{{$i}}</a>
                        </li>
                        {{ end }}
                        <li class="page-item {{if eq .page .totalPages}}disabled{{end}}">
                            <a class="page-link rounded-pill px-3"
                                href="?page={{.nextPage}}{{if .search}}&search={{.search}}{{end}}{{if .tag}}&tag={{.tag}}{{end}}"
                                aria-disabled="{{if eq .page .totalPages}}true{{end}}">&raquo;</a>
                        </li>
                    </ul>
                </nav>

            </div>
            <div class="col-lg-4">
                <div class="card-custom mb-4 p-4 border-0 shadow-sm">
                    <h5 class="fw-bold mb-3">Filter Articles</h5>
                    <div class="d-flex gap-2 mb-3">
                        <input id="searchInput" class="form-control" type="text" placeholder="Search titles or content"
                            value="{{ .search }}" />
                        <button id="button-search" class="btn btn-outline-secondary">Search</button>
                    </div>
                    <div class="mb-2">
                        <div class="small text-muted mb-1">Filter by tag</div>
                        <div>
                            {{ if .availableTags }}
                            {{ range $i, $t := .availableTags }}
                            <a href="/blog?tag={{ $t.Name }}" class="badge bg-light text-dark me-1 mb-1">{{ $t.Name
                                }}</a>
                            {{ end }}
                            {{ else }}
                            <div class="text-muted small">No tags yet</div>
                            {{ end }}
                        </div>
                    </div>
                    {{ if .isLoggedIn }}
                    <a href="/blog-post" class="btn btn-orange w-100">New Post</a>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchButton = document.getElementById("button-search");
        const searchInput = document.getElementById("searchInput");
        searchButton.addEventListener("click", function () {
            const searchTerm = searchInput.value;
            const params = new URLSearchParams(window.location.search);
            if (searchTerm) params.set('search', searchTerm); else params.delete('search');
            // keep tag if present
            window.location.href = '/blog?' + params.toString();
        });
        searchInput.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                searchButton.click();
            }
        });
    });
</script>

{{ template "footer.html" . }}